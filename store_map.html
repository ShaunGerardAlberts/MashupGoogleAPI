<html>
<head>
  <meta http-equiv="Access-Control-Allow-Origin" content="*"/>
  <style>
    html, body {
      height: 100%;
      width: 80%;
      margin: auto;
      padding: 0;
    }
    #form1 {
      /* background-color: red; */
      margin-top: 50px;
    }
    #map {
      height: 70%;
    }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script>
    $(document).ready(function(){
      markers = [];

      $("#form1").submit(function(event){
        event.preventDefault();
        //remove all markers on page already
        for (let i = 0; i < markers.length; i++) {
          markers[i].setMap(null);
        };
        var getForm = $('#form1');
        var getFormArray = getForm.serializeArray();
        var postCode = getFormArray[0].value;
        
        //console.log(postCode);
        $.ajax( {
          url: "http://localhost:8080/getlocation?postcode=" + postCode,
          method: "get",
          dataType: "json"
        })
        .done( function(msg) {
          console.log(msg);
          var name = msg.name;
          var lat = msg.lat;
          var lon = msg.lon;
          $("#testId").text("name: " + name + ", lat: " + lat + ", lon: " + lon);
          //have the needed details, make marker
          marker = new google.maps.Marker({
            map: map,
            position: {lat: parseInt(lat), lng: parseInt(lon)},
            title: name
          });
          markers.push(marker);
        })
        .fail(function(error) {
          alert("An Error Occured");
        })
        $("#store_postcode").val("");
      })
    });
    </script>
</head>
  <body>

    <form id="form1">
      <label>Store Postcode: </label> <input name="postcode" id="store_postcode" type="text" />
      <button id="submit">Show Store</button>
    </form>
    
    <div id="map"></div>

    <script>
      var map;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: -26.715, lng: 153.064},
          zoom: 5
        });
       }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCO3hE4bE7WV7mGuXL4kn9caoWI44tD8Ic&callback=initMap" async defer></script>
  </body>
</html>
